# 1. Initial Brain Service Setup and Semantic Chunking Exploration

**Date:** 2025-12-16
**Commit:** f2b726c6df55c20062de52eaac5ac1efcda96ee5

## 1. Overview
We have established the `vekku-brain-service` as a dedicated microservice for handling the intelligent logic of Vekku. This service is built with **TypeScript** and **Express**, utilizing **Qdrant** as the vector database for long-term memory and retrieval.

## 2. Methodology & Architecture

### Microservice Design
- **Separation of Concerns:** The brain service is decoupled from the main Spring Boot backend. This allows for independent scaling and the use of the Node.js ecosystem, which is rich in AI/ML libraries.
- **Communication:** Designed to interact via REST/gRPC (future) with the main server.

### Core Stack
- **Language:** TypeScript for type safety and developer ergonomics.
- **Framework:** Express.js for the API layer.
- **Vector DB:** Qdrant for storing embeddings and metadata.
- **ML Models:** Using `@huggingface/transformers` for generating embeddings (e.g., `Xenova/bge-small-en-v1.5`).

## 3. Features Implemented

### BrainLogic Singleton
We implemented `BrainLogic` as a singleton to manage the connection to Qdrant and the loading of the embedding model. This ensures resource efficiency, as the model is heavy to load.

### Tag Learning
The service can "learn" tags by embedding them and storing them in Qdrant with specific metadata (`type: "TAG"`). This allows for semantic retrieval of tags later.

### Content Tag Suggestion
We implemented a `suggestTags` method that:
1.  Receives content.
2.  Splits it into chunks.
3.  Embeds the chunks.
4.  Queries Qdrant for semantically similar tags.

## 4. Experiments: Semantic Chunking

We explored different strategies for splitting text to ensure that embeddings capture coherent thoughts.

### Current Implementation: Recursive Character Splitting
In `BrainLogic.ts`, we currently use `RecursiveCharacterTextSplitter` from `@langchain/textsplitters`.
- **Pros:** Robust, standard, predictable.
- **Cons:** May split sentences in the middle of a semantic idea if not careful.

### Experiment: Semantic Chunking
We created a reproduction script `repro_chunk.ts` to test `semantic-chunking`.
- **Method:** Uses embedding similarity to determine break points between chunks.
- **Observations:** This approach promises higher quality boundaries but introduces more complexity and dependency on the embedding model for the splitting process itself.
- **Status:** Currently under evaluation. The reproduction script demonstrates functionality, but it has not been fully merged into the main `BrainLogic` flow, which relies on the stability of the recursive splitter for now.

## 5. Next Steps
- Evaluate the performance cost of semantic chunking vs. its quality benefits.
- Fully integrate the superior chunking strategy into `BrainLogic`.
- Formalize the API contract with the main Vekku server.
